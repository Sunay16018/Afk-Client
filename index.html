<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BotMaster v25 - Full Edition</title>
    <style>
        :root { --bg: #0c0c0e; --p: #16161a; --b: #2d2d33; --a: #6366f1; --t: #f4f4f5; --r: #f43f5e; --g: #10b981; }
        * { box-sizing: border-box; outline: none; }
        body { background: var(--bg); color: var(--t); margin: 0; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; }
        
        nav { display: flex; background: var(--p); height: 50px; width: 100%; max-width: 480px; border-bottom: 2px solid var(--b); gap: 4px; padding: 5px; flex-shrink: 0; }
        nav button { flex: 1; background: #232329; border: none; color: #888; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 11px; }
        nav button.active { background: var(--a); color: white; }

        .tab { display: none; padding: 10px; width: 100%; max-width: 480px; flex: 1; overflow-y: auto; }
        .tab.show { display: flex; flex-direction: column; }

        .card { background: var(--p); border: 1px solid var(--b); border-radius: 10px; padding: 12px; margin-bottom: 10px; }
        .input-box { width: 100%; padding: 10px; background: #000; border: 1px solid var(--b); color: #fff !important; border-radius: 6px; margin-bottom: 8px; font-size: 14px; }
        
        .bot-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #111; border: 1px solid var(--b); border-radius: 8px; margin-bottom: 6px; cursor: pointer; }
        .bot-row.active { border-color: var(--a); background: #1a1a22; }

        .con-wrapper { width: 100%; border: 2px solid var(--b); border-radius: 12px; overflow: hidden; background: #000; display: flex; flex-direction: column; }
        #logs { height: 260px; overflow-y: auto; padding: 10px; font-family: monospace; font-size: 12px; line-height: 1.4; color: #eee; }
        .log-row { border-bottom: 1px solid #111; padding: 3px 0; white-space: pre-wrap; word-break: break-all; }

        .chat-bar { display: flex; padding: 8px; gap: 6px; background: #1a1a1e; border-top: 2px solid var(--b); }
        .chat-bar input { flex: 1; background: #000; border: 1px solid var(--b); color: #fff; padding: 10px; border-radius: 6px; }

        .inv-gui { background: #8b8b8b; padding: 8px; border: 3px solid #373737; display: grid; grid-template-columns: repeat(9, 1fr); gap: 3px; width: fit-content; margin: 0 auto; }
        .slot { width: 34px; height: 34px; background: #8b8b8b; border: 2px solid #373737; display: flex; align-items: center; justify-content: center; position: relative; }
        .slot img { width: 28px; image-rendering: pixelated; }

        .btn { background: var(--a); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; }
        .btn-red { background: var(--r); padding: 6px 12px; font-size: 11px; width: auto; }
        
        .ctrl-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
    </style>
</head>
<body onclick="hideCtx()">

    <nav>
        <button onclick="tab('bots', this)" class="active">BOTLAR</button>
        <button onclick="tab('console', this)">KONSOL</button>
        <button onclick="tab('status', this)">DURUM</button>
        <button onclick="tab('settings', this)">AYARLAR</button>
    </nav>

    <div id="p-bots" class="tab show">
        <div class="card">
            <input id="ip" class="input-box" placeholder="server:port">
            <input id="usr" class="input-box" placeholder="Bot ƒ∞smi">
            <button onclick="connect()" class="btn" style="background:var(--g)">OYUNA SOK</button>
        </div>
        <div id="blist"></div>
    </div>

    <div id="p-console" class="tab">
        <div id="cur-bot-name" style="font-size:12px; margin-bottom:6px; color:var(--a); font-weight:bold; text-align:center;">Se√ßili: Yok</div>
        <div class="con-wrapper">
            <div id="logs"></div>
            <div class="chat-bar">
                <input id="msg" placeholder="Mesaj g√∂nder..." onkeydown="if(event.key==='Enter') send()">
                <button onclick="send()" class="btn" style="width:auto; padding:0 20px;">></button>
            </div>
        </div>
    </div>

    <div id="p-status" class="tab">
        <div class="card" style="text-align:center; font-weight:bold;">‚ù§Ô∏è <span id="hp">0</span> | üçñ <span id="fd">0</span></div>
        <div class="inv-gui" id="inv"></div>
    </div>

    <div id="p-settings" class="tab">
        <div class="card">
            <b style="display:block; margin-bottom:8px;">Otomatik Mesaj (Spam)</b>
            <input id="mtxt" class="input-box" placeholder="Mesaj metni...">
            <div style="display:flex; align-items:center; gap:10px;">
                <input id="msec" type="number" class="input-box" value="10" style="width:80px; margin:0;"> <span>Saniye</span>
            </div>
            <button id="mbtn" class="btn" onclick="toggleSpam()" style="margin-top:10px;">SPAM BA≈ûLAT</button>
        </div>

        <div class="card">
            <b>Hareket Kontrol√º</b>
            <div class="ctrl-grid">
                <button class="btn" onmousedown="mv('forward','on')" onmouseup="mv('forward','off')" ontouchstart="mv('forward','on')" ontouchend="mv('forward','off')">ƒ∞LERƒ∞</button>
                <button class="btn" onmousedown="mv('back','on')" onmouseup="mv('back','off')" ontouchstart="mv('back','on')" ontouchend="mv('back','off')">GERƒ∞</button>
                <button class="btn" style="background:var(--b)" onclick="lk('left')">SOLA BAK</button>
                <button class="btn" style="background:var(--b)" onclick="lk('right')">SAƒûA BAK</button>
            </div>
        </div>
    </div>

    <script>
        let sel = null;
        let botLogs = {};
        let spamOn = false;

        function tab(t, b) {
            document.querySelectorAll('.tab').forEach(x=>x.classList.remove('show'));
            document.querySelectorAll('nav button').forEach(x=>x.classList.remove('active'));
            document.getElementById('p-'+t).classList.add('show');
            b.classList.add('active');
        }

        async function connect() {
            const h = document.getElementById('ip').value, u = document.getElementById('usr').value;
            if(!h || !u) return;
            await fetch(`/start?host=${h}&user=${u}`);
            switchBot(u);
            tab('console', document.querySelectorAll('nav button')[1]);
        }

        function switchBot(u) {
            sel = u;
            if(!botLogs[u]) botLogs[u] = [];
            document.getElementById('cur-bot-name').innerText = "SE√áƒ∞Lƒ∞ BOT: " + u;
            document.getElementById('logs').innerHTML = botLogs[u].join('');
            document.getElementById('logs').scrollTop = document.getElementById('logs').scrollHeight;
        }

        async function disconnect(u, e) {
            e.stopPropagation();
            await fetch(`/stop?user=${u}`);
            delete botLogs[u];
            if(sel === u) { sel = null; document.getElementById('logs').innerHTML = ''; document.getElementById('cur-bot-name').innerText = "Se√ßili: Yok"; }
        }

        async function send() {
            const m = document.getElementById('msg');
            if(!sel || !m.value) return;
            fetch(`/send?user=${sel}&msg=${encodeURIComponent(m.value)}`);
            m.value = '';
        }

        function mv(v, s) { if(sel) fetch(`/update?user=${sel}&type=move&val=${v}&status=${s}`); }
        function lk(v) { if(sel) fetch(`/update?user=${sel}&type=look&val=${v}`); }

        function toggleSpam() {
            if(!sel) return;
            spamOn = !spamOn;
            const b=document.getElementById('mbtn'), t=document.getElementById('mtxt').value, s=document.getElementById('msec').value;
            b.innerText = spamOn ? 'SPAM DURDUR' : 'SPAM BA≈ûLAT';
            b.style.background = spamOn ? 'var(--r)' : 'var(--a)';
            fetch(`/update?user=${sel}&type=auto_msg&status=${spamOn?'on':'off'}&val=${t}|${s}`);
        }

        setInterval(async () => {
            const r = await fetch(`/data?user=${sel||''}`);
            const d = await r.json();

            document.getElementById('blist').innerHTML = d.active.map(b => `
                <div class="bot-row ${sel===b?'active':''}" onclick="switchBot('${b}')">
                    <span style="font-weight:bold;">${b}</span>
                    <button class="btn-red" onclick="disconnect('${b}', event)">BAƒûLANTIYI KES</button>
                </div>
            `).join('');

            if(sel && d.botData[sel]) {
                const b = d.botData[sel];
                if(b.logs.length > 0) {
                    botLogs[sel].push(...b.logs);
                    if(botLogs[sel].length > 200) botLogs[sel].shift();
                    const lb = document.getElementById('logs');
                    b.logs.forEach(msg => {
                        const div = document.createElement('div');
                        div.className = 'log-row';
                        div.innerHTML = msg;
                        lb.appendChild(div);
                    });
                    lb.scrollTop = lb.scrollHeight;
                }
                document.getElementById('hp').innerText = Math.round(b.health) || 0;
                document.getElementById('fd').innerText = Math.round(b.food) || 0;
                const iG = document.getElementById('inv'); iG.innerHTML = '';
                for(let i=9; i<45; i++) {
                    const it = b.inventory.find(x=>x.slot===i);
                    iG.innerHTML += `<div class="slot">${it?`<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png">`:''}</div>`;
                }
            }
        }, 1000);
    </script>
</body>
</html>

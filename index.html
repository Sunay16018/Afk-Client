<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BotMaster v20 Ultra</title>
    <style>
        :root { --bg: #09090b; --p: #18181b; --b: #27272a; --a: #8b5cf6; --t: #f4f4f5; --g: #10b981; --r: #ef4444; }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--t); margin: 0; font-family: sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        nav { display: flex; background: var(--p); height: 60px; border-bottom: 2px solid var(--b); padding: 5px; gap: 5px; flex-shrink: 0; }
        nav button { flex: 1; background: #27272a; border: none; color: #a1a1aa; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 11px; }
        nav button.active { background: var(--a); color: white; }
        .tab { display: none; height: calc(100vh - 60px); padding: 15px; overflow-y: auto; }
        .tab.show { display: flex; flex-direction: column; }
        .card { background: var(--p); border: 1px solid var(--b); border-radius: 12px; padding: 15px; margin-bottom: 12px; }
        .con { background: #000; border: 1px solid var(--b); border-radius: 10px; flex: 1; display: flex; flex-direction: column; overflow: hidden; min-height: 300px; }
        #logs { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; font-family: monospace; white-space: pre-wrap; }
        .chat-bar { display: flex; padding: 10px; gap: 5px; background: #111; border-top: 1px solid var(--b); }
        .chat-bar input { flex: 1; background: #27272a; border: 1px solid var(--b); color: white; padding: 10px; border-radius: 5px; }
        .ctrls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .btn { background: #27272a; border: 1px solid var(--b); color: white; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; text-align: center; }
        .btn:active { background: var(--a); }
        .inv { display: grid; grid-template-columns: repeat(9, 1fr); gap: 4px; }
        .slot { aspect-ratio: 1; background: #000; border: 1px solid var(--b); position: relative; display: flex; align-items: center; justify-content: center; }
        .slot img { width: 80%; image-rendering: pixelated; }
        #ctx { display: none; position: fixed; background: #1c1c1f; border: 1px solid var(--b); z-index: 999; width: 120px; box-shadow: 0 10px 20px #000; border-radius: 8px; }
        #ctx button { display: block; width: 100%; padding: 12px; background: none; border: none; color: white; border-bottom: 1px solid var(--b); text-align: left; font-size: 12px; cursor: pointer; }
        .bot-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #27272a; border-radius: 8px; margin-bottom: 5px; border: 2px solid transparent; }
        .bot-item.active { border-color: var(--a); }
    </style>
</head>
<body>
    <nav>
        <button onclick="tab('bots', this)" class="active">BOTLAR</button>
        <button onclick="tab('console', this)">SOHBET</button>
        <button onclick="tab('status', this)">ENVANTER</button>
        <button onclick="tab('settings', this)">AYARLAR</button>
    </nav>

    <div id="ctx">
        <button onclick="invA('equip')">‚öîÔ∏è Elinde Tut</button>
        <button onclick="invA('use')">üçé Kullan</button>
        <button onclick="invA('toss')">üóëÔ∏è 1 Tane At</button>
        <button onclick="invA('drop')">üì¶ Hepsini At</button>
    </div>

    <div id="p-bots" class="tab show">
        <div class="card">
            <input id="ip" class="chat-bar" style="width:100%; margin-bottom:8px; border-radius:8px" placeholder="Server IP:Port">
            <input id="usr" class="chat-bar" style="width:100%; margin-bottom:8px; border-radius:8px" placeholder="Bot ƒ∞smi">
            <button onclick="connect()" class="btn" style="width:100%; background:var(--g)">BAƒûLAN</button>
        </div>
        <div id="blist"></div>
    </div>

    <div id="p-console" class="tab">
        <div class="con"><div id="logs"></div><div class="chat-bar"><input id="msg" placeholder="Mesaj..."><button onclick="send()" class="btn">></button></div></div>
    </div>

    <div id="p-status" class="tab">
        <div class="card">Can: <span id="hp">20</span> | A√ßlƒ±k: <span id="fd">20</span></div>
        <div class="card"><div id="inv" class="inv"></div></div>
    </div>

    <div id="p-settings" class="tab">
        <div class="card">
            <b>Oto Mesaj</b>
            <input id="mtxt" class="chat-bar" style="width:100%; margin:8px 0" placeholder="Mesaj i√ßeriƒüi...">
            <input id="msec" type="number" class="chat-bar" style="width:100%; margin-bottom:8px" value="10" placeholder="Saniye">
            <button id="mbtn" class="btn" style="width:100%" onclick="toggleSpam()">OTOMATƒ∞K MESAJI A√á</button>
        </div>
        <div class="card ctrls">
            <div></div><button class="btn" ontouchstart="mv('forward','on')" ontouchend="mv('forward','off')">ƒ∞LERƒ∞</button><div></div>
            <button class="btn" ontouchstart="mv('left','on')" ontouchend="mv('left','off')">SOL</button>
            <button class="btn" ontouchstart="mv('back','on')" ontouchend="mv('back','off')">GERƒ∞</button>
            <button class="btn" ontouchstart="mv('right','on')" ontouchend="mv('right','off')">SAƒû</button>
            <button class="btn" onclick="lk('left')">‚óÄ</button>
            <button class="btn" onclick="mv('jump','on')">ZIPLA</button>
            <button class="btn" onclick="lk('right')">‚ñ∂</button>
        </div>
    </div>

    <script>
        let sel = null; let botLogs = {}; let spamOn = false; let cSlot = 0;
        function tab(id, b) {
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('show'));
            document.querySelectorAll('nav button').forEach(n=>n.classList.remove('active'));
            document.getElementById('p-'+id).classList.add('show');
            b.classList.add('active'); if(id==='console') scrl();
        }
        function scrl() { const o=document.getElementById('logs'); o.scrollTop=o.scrollHeight; }
        
        async function connect() {
            const h=document.getElementById('ip').value, u=document.getElementById('usr').value;
            if(!h||!u) return; await fetch(`/start?host=${h}&user=${u}`);
            sel=u; if(!botLogs[u]) botLogs[u]=[]; tab('console', document.querySelectorAll('nav button')[1]);
        }

        async function send() {
            const m=document.getElementById('msg'); if(!sel||!m.value) return;
            await fetch(`/send?user=${sel}&msg=${encodeURIComponent(m.value)}`); m.value='';
        }

        async function mv(v, s) { if(sel) fetch(`/update?user=${sel}&type=move&val=${v}&status=${s}`); }
        async function lk(v) { if(sel) fetch(`/update?user=${sel}&type=look&val=${v}`); }

        function toggleSpam() {
            if(!sel) return; spamOn = !spamOn;
            const b=document.getElementById('mbtn'), t=document.getElementById('mtxt').value, s=document.getElementById('msec').value;
            b.style.background = spamOn ? 'var(--g)' : 'var(--b)';
            b.innerText = spamOn ? 'MESAJ A√áIK' : 'OTOMATƒ∞K MESAJI A√á';
            fetch(`/update?user=${sel}&type=auto_msg&status=${spamOn?'on':'off'}&val=${t}|${s}`);
        }

        function openCtx(e, s) {
            e.preventDefault(); cSlot=s; const m=document.getElementById('ctx');
            m.style.display='block'; m.style.left=e.pageX+'px'; m.style.top=e.pageY+'px';
        }
        async function invA(a) { if(sel) fetch(`/update?user=${sel}&type=inv&val=${cSlot}&status=${a}`); document.getElementById('ctx').style.display='none'; }

        setInterval(async () => {
            const r=await fetch(`/data?user=${sel||''}`); const d=await r.json();
            document.getElementById('blist').innerHTML = d.active.map(b => `
                <div class="bot-item ${sel===b?'active':''}" onclick="sel='${b}'; document.getElementById('logs').innerHTML=(botLogs[b]||[]).join('');">
                    <span>${b}</span>
                    <button onclick="fetch('/stop?user=${b}')" style="background:var(--r); color:white; border:none; padding:5px; border-radius:4px">KOPAR</button>
                </div>
            `).join('');

            if(sel && d.botData[sel]) {
                const b=d.botData[sel];
                if(b.logs.length > 0) {
                    if(!botLogs[sel]) botLogs[sel]=[];
                    botLogs[sel].push(...b.logs);
                    document.getElementById('logs').innerHTML = botLogs[sel].join('');
                    scrl();
                }
                document.getElementById('hp').innerText=Math.round(b.health);
                document.getElementById('fd').innerText=Math.round(b.food);
                const iG=document.getElementById('inv'); iG.innerHTML='';
                for(let i=9; i<45; i++){
                    const it=b.inventory.find(x=>x.slot===i);
                    iG.innerHTML += `<div class="slot" onclick="openCtx(event, ${i})">${it?`<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png">`:''}</div>`;
                }
            }
        }, 1200);

        document.body.onclick = () => document.getElementById('ctx').style.display='none';
    </script>
</body>
</html>

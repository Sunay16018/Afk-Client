<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Geli≈ümi≈ü AFK Client</title>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; font-size: 13px; }
        body { background: #0d1117; color: #c9d1d9; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        nav { display: flex; background: #161b22; border-bottom: 1px solid #30363d; height: 45px; }
        nav button { flex: 1; border: none; background: none; color: #8b949e; cursor: pointer; font-weight: bold; }
        nav button.active { color: #2ecc71; border-bottom: 2px solid #2ecc71; }

        .tab { display: none; flex: 1; padding: 10px; overflow-y: auto; flex-direction: column; }
        .active-tab { display: flex; }

        #logbox { height: 200px; background: #000; color: #2ecc71; padding: 10px; overflow-y: auto; font-family: monospace; border-radius: 5px; border: 1px solid #30363d; margin-bottom: 10px; }

        .inv-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 5px; background: #1c2128; padding: 10px; border-radius: 8px; border: 1px solid #30363d; }
        .slot { aspect-ratio: 1; background: #0d1117; border: 1px solid #30363d; border-radius: 4px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; }
        .slot:hover { border-color: #2ecc71; }
        .slot img { width: 80%; image-rendering: pixelated; }
        .count { position: absolute; bottom: 0; right: 2px; font-size: 10px; font-weight: bold; }

        /* Modern Men√º (Context Menu) */
        #menu { display: none; position: fixed; background: #161b22; border: 1px solid #2ecc71; padding: 10px; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        #menu button { display: block; width: 100%; margin: 5px 0; padding: 8px; border-radius: 4px; border: none; cursor: pointer; color: white; font-weight: bold; }

        .card { background: #161b22; padding: 15px; border-radius: 8px; border: 1px solid #30363d; margin-bottom: 10px; }
        input { background: #010409; border: 1px solid #30363d; color: #fff; padding: 10px; width: 100%; margin: 5px 0; border-radius: 6px; }
        .btn { padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; background: #1f6feb; }
    </style>
</head>
<body onclick="closeMenu()">
    <nav>
        <button onclick="tab('bots')" id="btn-bots" class="active">BOTLAR</button>
        <button onclick="tab('term')" id="btn-term">SOHBET</button>
        <button onclick="tab('inv')" id="btn-inv">ENVANTER</button>
        <button onclick="tab('settings')" id="btn-settings">AYARLAR</button>
    </nav>

    <div id="menu">
        <div id="item-info" style="font-size:11px; color:#8b949e; margin-bottom:8px;"></div>
        <button onclick="itemAct('equip')" style="background:#1f6feb;">ELƒ∞NDE TUT</button>
        <button onclick="itemAct('toss')" style="background:#e3b341;">1 TANE AT</button>
        <button onclick="itemAct('drop')" style="background:#da3633;">HEPSƒ∞Nƒ∞ AT</button>
    </div>

    <div id="tab-bots" class="tab active-tab">
        <div class="card">
            <input id="h" placeholder="Sunucu IP:Port">
            <input id="u" placeholder="Bot ƒ∞smi">
            <input id="v" placeholder="S√ºr√ºm (√∂rn: 1.16.5)">
            <button class="btn" style="width:100%; background:#238636;" onclick="add()">BAƒûLAN</button>
        </div>
        <div id="list"></div>
    </div>

    <div id="tab-term" class="tab">
        <div id="logbox"></div>
        <div style="display:flex; gap:5px;">
            <input id="m" placeholder="Mesaj..." style="flex:1;">
            <button class="btn" onclick="doSend()">G√ñNDER</button>
        </div>
    </div>

    <div id="tab-inv" class="tab">
        <div id="stats" style="margin-bottom:10px; text-align:center;">‚ù§Ô∏è Can: - | üçñ A√ßlƒ±k: -</div>
        <div class="inv-grid" id="inv-box"></div>
    </div>

    <div id="tab-settings" class="tab">
        <div class="card">
            <h4>Oto Mesaj (Spam)</h4>
            <input id="stxt" placeholder="Mesaj...">
            <input id="ssec" type="number" value="10">
            <button class="btn" style="background:#238636" onclick="upd('msg','on')">BA≈ûLAT</button>
            <button class="btn" style="background:#da3633" onclick="upd('msg','off')">DURDUR</button>
        </div>
        <div class="card">
            <h4>Karakter</h4>
            <button class="btn" style="width:100%; background:#1f6feb" onclick="upd('afk','on')">ANTƒ∞-AFK A√á</button>
            <button class="btn" style="width:100%; margin-top:10px; background:#da3633" onclick="stopBot()">BAƒûLANTIYI KES</button>
        </div>
    </div>

    <script>
        // TARAYICIYA √ñZEL SID OLU≈ûTURMA
        if(!localStorage.getItem('sid')) localStorage.setItem('sid', 'user_'+Math.random().toString(36).substr(2,10));
        const mySID = localStorage.getItem('sid');
        let sel = "";
        let curSlot = null;

        function tab(t) {
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active-tab'));
            document.querySelectorAll('nav button').forEach(x => x.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active-tab');
            document.getElementById('btn-'+t).classList.add('active');
        }

        async function add() {
            const h = document.getElementById('h').value, u = document.getElementById('u').value, v = document.getElementById('v').value;
            await fetch(`/start?sid=${mySID}&host=${h}&user=${u}&ver=${v}`);
            sel = u; tab('term');
        }

        function showMenu(e, slot, name, nbt) {
            e.preventDefault(); e.stopPropagation();
            curSlot = slot;
            const m = document.getElementById('menu');
            document.getElementById('item-info').innerText = name + "\n" + (nbt ? "B√ºy√ºl√º / √ñzel E≈üya" : "Normal E≈üya");
            m.style.display = 'block';
            m.style.left = e.pageX + "px";
            m.style.top = e.pageY + "px";
        }

        function closeMenu() { document.getElementById('menu').style.display = 'none'; }

        async function itemAct(act) {
            if(!sel || curSlot === null) return;
            await fetch(`/update?sid=${mySID}&user=${sel}&type=inv&val=${curSlot}&status=${act}`);
            closeMenu();
        }

        async function doSend() {
            const i = document.getElementById('m');
            if(!sel || !i.value) return;
            await fetch(`/send?sid=${mySID}&user=${sel}&msg=${encodeURIComponent(i.value)}`);
            i.value = "";
        }

        async function upd(type, status) {
            if(!sel) return;
            let val = encodeURIComponent(document.getElementById('stxt').value);
            let sec = document.getElementById('ssec').value;
            await fetch(`/update?sid=${mySID}&user=${sel}&type=${type}&status=${status}&val=${val}&sec=${sec}`);
        }

        async function stopBot() {
            await fetch(`/stop?sid=${mySID}&user=${sel}`);
            sel = ""; tab('bots');
        }

        setInterval(async () => {
            try {
                const r = await fetch(`/data?sid=${mySID}&user=${sel}`);
                const d = await r.json();
                
                // Bot Listesi
                document.getElementById('list').innerHTML = d.active.map(n => `
                    <div style="padding:12px; background:#161b22; border:1px solid ${sel==n?'#2ecc71':'#30363d'}; margin-top:8px; border-radius:8px; cursor:pointer;" onclick="sel='${n}'">
                        ${n} ${sel==n?'<span style="color:#2ecc71; float:right;">‚óè SE√áƒ∞Lƒ∞</span>':''}
                    </div>
                `).join('');

                if(sel && d.logs[sel]) {
                    const lb = document.getElementById('logbox');
                    lb.innerHTML = d.logs[sel].join('<br>');
                    lb.scrollTop = lb.scrollHeight;

                    // Envanter ve Can
                    if(d.botData[sel]) {
                        const bd = d.botData[sel];
                        document.getElementById('stats').innerText = `‚ù§Ô∏è Can: ${Math.round(bd.hp)} | üçñ A√ßlƒ±k: ${Math.round(bd.food)}`;
                        
                        let invH = "";
                        for(let i=0; i<45; i++) {
                            const it = bd.inv.find(x => x.slot === i);
                            invH += `<div class="slot" onclick="showMenu(event, ${i}, '${it?it.display:''}', ${it?!!it.nbt:false})">
                                ${it ? `<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png" onerror="this.src='https://minecraft.wiki/images/Barrier_JE2_BE2.png'"><span class="count">${it.count > 1 ? it.count : ''}</span>` : ''}
                            </div>`;
                        }
                        document.getElementById('inv-box').innerHTML = invH;
                    }
                }
            } catch(e) {}
        }, 1000);
    </script>
</body>
</html>

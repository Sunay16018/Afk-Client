<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AFK Fix v10</title>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; font-size: 13px; user-select: none; }
        body { background: #0d1117; color: #c9d1d9; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        nav { display: flex; background: #161b22; border-bottom: 1px solid #30363d; height: 50px; }
        nav button { flex: 1; border: none; background: none; color: #8b949e; cursor: pointer; font-weight: bold; }
        nav button.active { color: #2ecc71; border-bottom: 2px solid #2ecc71; }
        .tab { display: none; flex: 1; padding: 10px; overflow-y: auto; flex-direction: column; }
        .active-tab { display: flex; }
        #logbox { height: 250px; background: #000; padding: 10px; overflow-y: auto; border: 1px solid #333; user-select: text; }
        .card { background: #161b22; padding: 10px; border-radius: 8px; border: 1px solid #30363d; margin-bottom: 10px; }
        input { background: #010409; border: 1px solid #30363d; color: #fff; padding: 8px; width: 100%; margin: 5px 0; user-select: text; }
        .btn { padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; width: 100%; }
        .on { background: #238636; } .off { background: #da3633; } .blue { background: #1f6feb; }
        .control-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: 150px; margin: 10px auto; }
        .ctrl { padding: 15px; background: #21262d; border: 1px solid #30363d; text-align: center; border-radius: 8px; }
        .inv-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 2px; }
        .slot { width: 32px; height: 32px; background: #333; border: 1px solid #444; }
        .slot img { width: 100%; }
    </style>
</head>
<body>
    <nav>
        <button onclick="tab('bots')" id="b-bots" class="active">BOTLAR</button>
        <button onclick="tab('term')" id="b-term">KONSOL</button>
        <button onclick="tab('settings')" id="b-settings">AYARLAR</button>
    </nav>

    <div id="t-bots" class="tab active-tab">
        <div class="card">
            <input id="h" placeholder="IP:Port">
            <input id="u" placeholder="İsim">
            <input id="v" placeholder="Sürüm">
            <button class="btn blue" onclick="add()">BAĞLAN</button>
        </div>
        <div id="list"></div>
    </div>

    <div id="t-term" class="tab">
        <div id="logbox"></div>
        <input id="m" placeholder="Mesaj..." onkeypress="if(event.key==='Enter')send()">
        <div class="control-pad">
            <div></div><div class="ctrl" onmousedown="move('forward',true)" onmouseup="move('forward',false)">↑</div><div></div>
            <div class="ctrl" onmousedown="move('left',true)" onmouseup="move('left',false)">←</div>
            <div class="ctrl" onclick="move('jump',true)">JMP</div>
            <div class="ctrl" onmousedown="move('right',true)" onmouseup="move('right',false)">→</div>
            <div></div><div class="ctrl" onmousedown="move('back',true)" onmouseup="move('back',false)">↓</div><div></div>
        </div>
    </div>

    <div id="t-settings" class="tab">
        <div id="coords" class="card" style="text-align:center">X: 0 Y: 0 Z: 0</div>
        <div class="card">
            <label>Komut Ekle (/login şifre)</label>
            <input id="ci" placeholder="/komut">
            <button class="btn blue" onclick="addC()">EKLE</button>
            <div id="clist" style="font-size:10px; margin-top:5px; color:gray"></div>
        </div>
        <div class="card"><button id="s-afk" class="btn" onclick="tog('afk')">AFK: ...</button></div>
        <div class="card"><button id="s-mining" class="btn" onclick="tog('mining')">KAZMA: ...</button></div>
        <div class="card"><button id="s-reconnect" class="btn" onclick="tog('reconnect')">OTO-BAĞLAN: ...</button></div>
        <div class="inv-grid" id="inv"></div>
    </div>

<script>
    let mySID = localStorage.getItem('sid') || 'sid_'+Math.random().toString(36).substr(2,9);
    localStorage.setItem('sid', mySID);
    let sel = "";

    function tab(t) {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active-tab'));
        document.querySelectorAll('nav button').forEach(x => x.classList.remove('active'));
        document.getElementById('t-'+t).classList.add('active-tab');
        document.getElementById('b-'+t).classList.add('active');
    }

    async function add() {
        const h=document.getElementById('h').value, u=document.getElementById('u').value, v=document.getElementById('v').value;
        await fetch(`/start?sid=${mySID}&host=${h}&user=${u}&ver=${v}`);
        sel = u; tab('term');
    }

    function send() { 
        const i=document.getElementById('m'); 
        fetch(`/send?sid=${mySID}&user=${sel}&msg=${encodeURIComponent(i.value)}`); 
        i.value=""; 
    }

    function move(d, s) { if(sel) fetch(`/move?sid=${mySID}&user=${sel}&dir=${d}&state=${s}`); }
    function tog(t) { if(sel) fetch(`/update?sid=${mySID}&user=${sel}&type=${t}`); }
    function addC() {
        const i=document.getElementById('ci');
        fetch(`/update?sid=${mySID}&user=${sel}&type=cmd&val=${encodeURIComponent(i.value)}`);
        i.value="";
    }

    setInterval(async () => {
        try {
            const r = await fetch(`/data?sid=${mySID}&user=${sel}`);
            const d = await r.json();
            
            // Bot listesi ve Otomatik Seçim (Kapanıp açılınca geri gelmesi için)
            if(!sel && d.active.length > 0) sel = d.active[0];
            
            document.getElementById('list').innerHTML = d.active.map(n => `
                <div class="card" style="border-color:${sel==n?'#2ecc71':'#333'}">
                    <b onclick="sel='${n}'">${n}</b>
                    <button class="btn off" style="width:50px; float:right; padding:2px" onclick="fetch('/stop?sid=${mySID}&user=${n}')">X</button>
                </div>
            `).join('');

            if(sel && d.logs[sel]) {
                const lb = document.getElementById('logbox');
                lb.innerHTML = d.logs[sel].join('<br>');
                lb.scrollTop = lb.scrollHeight;

                const c = d.configs[sel];
                if(c) {
                    document.getElementById('s-afk').className = "btn " + (c.afk?"on":"off");
                    document.getElementById('s-afk').innerText = "AFK: " + (c.afk?"AÇIK":"KAPALI");
                    document.getElementById('s-mining').className = "btn " + (c.mining?"on":"off");
                    document.getElementById('s-mining').innerText = "KAZMA: " + (c.mining?"AÇIK":"KAPALI");
                    document.getElementById('s-reconnect').className = "btn " + (c.reconnect?"on":"off");
                    document.getElementById('s-reconnect').innerText = "OTO-BAĞLAN: " + (c.reconnect?"AÇIK":"KAPALI");
                    document.getElementById('clist').innerText = "Kayıtlı: " + c.cmds.join(', ');
                }

                if(d.botData[sel]) {
                    const bd = d.botData[sel];
                    document.getElementById('coords').innerText = `X: ${Math.floor(bd.pos.x)} Y: ${Math.floor(bd.pos.y)} Z: ${Math.floor(bd.pos.z)}`;
                    document.getElementById('inv').innerHTML = bd.inv.map(i => `<div class="slot" onclick="fetch('/update?sid=${mySID}&user=${sel}&type=inv&val=${i.slot}')"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${i.name}.png"></div>`).join('');
                }
            }
        } catch(e) {}
    }, 1000);
</script>
</body>
</html>

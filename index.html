<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BotMaster v17 Pro</title>
    <style>
        :root { 
            --bg: #0c0c0e; --panel: #16161a; --border: #2d2d33; 
            --accent: #6366f1; --text: #f4f4f5; --green: #10b981; 
            --red: #f43f5e; --yellow: #f59e0b;
        }
        * { box-sizing: border-box; outline: none; }
        body { 
            background: var(--bg); color: var(--text); margin: 0; 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* ÜST NAVİGASYON */
        nav { 
            display: flex; background: var(--panel); height: 60px; 
            border-bottom: 2px solid var(--border); padding: 0 10px; 
            align-items: center; gap: 8px; flex-shrink: 0;
        }
        nav button { 
            flex: 1; background: #232329; border: 1px solid var(--border); 
            color: #a1a1aa; font-weight: bold; font-size: 11px; cursor: pointer; 
            padding: 12px 5px; border-radius: 8px; text-transform: uppercase;
        }
        nav button.active { background: var(--accent); color: white; border-color: var(--accent); }
        
        /* İÇERİK ALANLARI */
        .tab { 
            display: none; height: calc(100vh - 60px); padding: 15px; 
            overflow-y: auto; flex-direction: column; width: 100%; max-width: 600px; margin: 0 auto;
        }
        .tab.show { display: flex; }

        /* GİRİŞ ALANLARI (DÜZELTİLDİ - SİMSİYAH DEĞİL) */
        .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .title { color: var(--accent); font-size: 12px; font-weight: 800; text-transform: uppercase; margin-bottom: 12px; display: block; }
        
        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; font-size: 11px; color: #71717a; margin-bottom: 5px; font-weight: bold; }
        
        input.main-input { 
            width: 100%; padding: 12px; background: #1f1f23; border: 1px solid var(--border); 
            color: white; border-radius: 8px; font-size: 14px; display: block;
        }
        input.main-input:focus { border-color: var(--accent); background: #25252b; }

        /* KONSOL (ORTA BOY) */
        .console-box { 
            display: flex; flex-direction: column; background: #000; border: 2px solid var(--border); 
            border-radius: 12px; overflow: hidden; height: 45vh !important; min-height: 300px;
        }
        #log-output { 
            flex: 1; overflow-y: auto; padding: 10px; font-size: 12px; 
            line-height: 1.6; color: #d1d1d6; font-family: monospace;
        }
        .log-line { border-bottom: 1px solid #111; padding: 3px 0; display: block; }

        .chat-bar { display: flex; background: #111; padding: 8px; gap: 5px; border-top: 1px solid var(--border); }
        .chat-bar input { flex: 1; background: #1f1f23; border: 1px solid var(--border); color: white; padding: 10px; border-radius: 6px; }
        .chat-bar button { background: var(--accent); color: white; border: none; padding: 0 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* İSTATİSTİK & ENVANTER */
        .stat-bar { height: 12px; background: #27272a; border-radius: 6px; overflow: hidden; margin: 5px 0 15px; }
        .stat-fill { height: 100%; transition: width 0.3s; }
        
        .inv-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 4px; background: #0c0c0e; padding: 8px; border-radius: 8px; }
        .slot { aspect-ratio: 1; background: #1f1f23; border: 1px solid #2d2d33; border-radius: 4px; display: flex; align-items: center; justify-content: center; position: relative; }
        .slot img { width: 75%; image-rendering: pixelated; }
        .slot .count { position: absolute; bottom: 1px; right: 2px; font-size: 9px; font-weight: bold; color: #fff; }

        /* AYARLAR (YENİLENENLER) */
        .setting-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; background: #1f1f23; border-radius: 10px; margin-bottom: 8px; 
        }
        .setting-item span { font-size: 13px; font-weight: 500; }
        .btn-toggle { padding: 6px 12px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; background: #3f3f46; color: #a1a1aa; }
        .btn-toggle.on { background: var(--green); color: white; }
        
        .btn-action { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 5px; }

        #ctx { display: none; position: fixed; background: #1f1f23; border: 1px solid var(--border); border-radius: 8px; z-index: 100; width: 120px; box-shadow: 0 5px 15px #000; }
        #ctx button { display: block; width: 100%; padding: 10px; background: none; border: none; color: white; border-bottom: 1px solid #2d2d33; text-align: left; }
    </style>
</head>
<body onclick="closeCtx()">

    <nav>
        <button onclick="tab('bots', this)" class="active">Giriş</button>
        <button onclick="tab('console', this)">Konsol</button>
        <button onclick="tab('status', this)">Durum</button>
        <button onclick="tab('settings', this)">Hileler</button>
    </nav>

    <div id="ctx"><button onclick="invAct('drop')">At</button><button onclick="invAct('equip')">Giy</button></div>

    <div id="p-bots" class="tab show">
        <div class="card">
            <span class="title">Sunucuya Bağlan</span>
            <div class="input-group">
                <label>Sunucu Adresi (IP:Port)</label>
                <input id="ip" class="main-input" placeholder="Örn: 127.0.0.1:25565">
            </div>
            <div class="input-group">
                <label>Kullanıcı Adı</label>
                <input id="name" class="main-input" placeholder="Bot İsmi">
            </div>
            <button class="btn-action" style="background: var(--green)" onclick="connect()">BAĞLANMAYI BAŞLAT</button>
        </div>
        <div id="bot-list"></div>
    </div>

    <div id="p-console" class="tab">
        <span class="title" id="cur-bot">Bot Seçilmedi</span>
        <div class="console-box">
            <div id="log-output"></div>
            <div class="chat-bar">
                <input id="chat-in" placeholder="Mesaj gönder..." onkeydown="if(event.key==='Enter') sendChat()">
                <button onclick="sendChat()">></button>
            </div>
        </div>
    </div>

    <div id="p-status" class="tab">
        <div class="card">
            <span class="title">İstatistikler</span>
            <div style="font-size:11px">CAN (<span id="hp-t">0</span>)</div>
            <div class="stat-bar"><div id="hp-f" class="stat-fill" style="background:var(--red)"></div></div>
            <div style="font-size:11px">AÇLIK (<span id="fd-t">0</span>)</div>
            <div class="stat-bar"><div id="fd-f" class="stat-fill" style="background:var(--yellow)"></div></div>
        </div>
        <div class="card">
            <span class="title">Envanter</span>
            <div id="inv-render" class="inv-grid"></div>
        </div>
    </div>

    <div id="p-settings" class="tab">
        <div class="card">
            <span class="title">Hareket & Rotasyon</span>
            <div class="setting-item"><span>Yönü Çevir (90°)</span><button class="btn-toggle" onclick="sendUpd('look', '90')">ÇEVİR</button></div>
            <div class="setting-item"><span>Zıpla</span><button class="btn-toggle" onclick="sendUpd('jump', 'once')">ZIPLA</button></div>
            <div class="setting-item"><span>Öne Git</span><button class="btn-toggle" id="sw-move" onclick="toggleBtn('move', this)">KAPALI</button></div>
        </div>
        <div class="card">
            <span class="title">Mesajlaşma</span>
            <input id="auto-msg-val" class="main-input" style="margin-bottom:8px" placeholder="Oto mesaj metni...">
            <div class="setting-item"><span>Oto Mesaj (30s)</span><button class="btn-toggle" id="sw-msg" onclick="toggleBtn('auto_msg', this, 'auto-msg-val')">KAPALI</button></div>
        </div>
    </div>

    <script>
        const sid = localStorage.getItem('sid') || 'S'+Math.random().toString(36).substr(2,5).toUpperCase();
        localStorage.setItem('sid', sid);
        let sel = null; let lastLogIdx = 0; let cSlot = 0;

        function tab(id, btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('show'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById('p-'+id).classList.add('show');
            btn.classList.add('active');
        }

        function closeCtx() { document.getElementById('ctx').style.display='none'; }
        function openCtx(e, s) { e.stopPropagation(); cSlot=s; const m=document.getElementById('ctx'); m.style.display='block'; m.style.left=e.pageX+'px'; m.style.top=e.pageY+'px'; }

        async function connect() {
            const i = document.getElementById('ip').value, n = document.getElementById('name').value;
            if(!i || !n) return;
            await fetch(`/start?sid=${sid}&host=${i}&user=${n}`);
            sel = n; lastLogIdx = 0;
            document.getElementById('cur-bot').innerText = n;
            tab('console', document.querySelectorAll('nav button')[1]);
        }

        async function sendChat() {
            const ci = document.getElementById('chat-in');
            if(!sel || !ci.value) return;
            await fetch(`/send?sid=${sid}&user=${sel}&msg=${encodeURIComponent(ci.value)}`);
            ci.value = '';
        }

        async function sendUpd(type, val) {
            if(!sel) return;
            await fetch(`/update?sid=${sid}&user=${sel}&type=${type}&val=${val}`);
        }

        async function toggleBtn(type, btn, valId) {
            if(!sel) return;
            const isOff = !btn.classList.contains('on');
            const val = valId ? document.getElementById(valId).value : 'on';
            await fetch(`/update?sid=${sid}&user=${sel}&type=${type}&status=${isOff?'on':'off'}&val=${val}`);
            btn.classList.toggle('on');
            btn.innerText = btn.classList.contains('on') ? "AÇIK" : "KAPALI";
        }

        async function invAct(a) {
            await fetch(`/update?sid=${sid}&user=${sel}&type=inv_action&slot=${cSlot}&act=${a}`);
        }

        setInterval(async () => {
            try {
                const res = await fetch(`/data?sid=${sid}&user=${sel || ''}`);
                const data = await res.json();

                const bl = document.getElementById('bot-list');
                bl.innerHTML = data.active.map(b => `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center; border-color:${sel==b? 'var(--accent)':'var(--border)'}" onclick="sel='${b}'; document.getElementById('cur-bot').innerText='${b}'">
                        <b>${b}</b> <button onclick="fetch('/stop?sid=${sid}&user=${b}')" style="background:var(--red); color:white; border:none; padding:5px 10px; border-radius:6px; font-size:10px;">DURDUR</button>
                    </div>
                `).join('');

                if(sel && data.botData[sel]) {
                    const b = data.botData[sel];
                    
                    // Logları 1 kez basma kontrolü
                    const logBox = document.getElementById('log-output');
                    if(b.logs && b.logs.length > lastLogIdx) {
                        for(let i=lastLogIdx; i<b.logs.length; i++) {
                            const line = document.createElement('span');
                            line.className = 'log-line';
                            line.innerText = typeof b.logs[i] === 'object' ? JSON.stringify(b.logs[i]) : b.logs[i];
                            logBox.appendChild(line);
                        }
                        lastLogIdx = b.logs.length;
                        logBox.scrollTop = logBox.scrollHeight;
                    }

                    // İstatistikler
                    document.getElementById('hp-t').innerText = Math.round(b.health);
                    document.getElementById('hp-f').style.width = (b.health / 20 * 100) + '%';
                    document.getElementById('fd-t').innerText = Math.round(b.food);
                    document.getElementById('fd-f').style.width = (b.food / 20 * 100) + '%';

                    // Envanter
                    const ir = document.getElementById('inv-render');
                    ir.innerHTML = '';
                    for(let i=9; i<45; i++) {
                        const it = b.inventory.find(x => x && x.slot === i);
                        ir.innerHTML += `
                            <div class="slot" oncontextmenu="openCtx(event, ${i})">
                                ${it ? `<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png"><span class="count">${it.count > 1 ? it.count : ''}</span>` : ''}
                            </div>`;
                    }
                }
            } catch(e) {}
        }, 1200);
    </script>
</body>
</html>

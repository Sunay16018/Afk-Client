<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BotMaster v18 - Private Edition</title>
    <style>
        :root { 
            --bg: #09090b; --panel: #111114; --border: #27272a; 
            --accent: #8b5cf6; --text: #fafafa; --green: #10b981; 
            --red: #ef4444; --card-bg: #18181b;
        }
        * { box-sizing: border-box; outline: none; }
        body { 
            background: var(--bg); color: var(--text); margin: 0; 
            font-family: 'Inter', system-ui, sans-serif; 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* ÃœST BAR */
        nav { 
            display: flex; background: var(--panel); height: 65px; 
            border-bottom: 1px solid var(--border); padding: 0 15px; 
            align-items: center; gap: 10px; flex-shrink: 0;
        }
        nav button { 
            flex: 1; background: #27272a; border: 1px solid transparent; 
            color: #a1a1aa; font-weight: 600; font-size: 11px; cursor: pointer; 
            padding: 12px 5px; border-radius: 8px; transition: 0.3s;
        }
        nav button.active { background: var(--accent); color: white; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
        
        /* Ä°Ã‡ERÄ°K YAPISI */
        .tab { 
            display: none; height: calc(100vh - 65px); padding: 20px; 
            overflow-y: auto; flex-direction: column; width: 100%; max-width: 700px; margin: 0 auto;
        }
        .tab.show { display: flex; }

        /* KART TASARIMI */
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 18px; margin-bottom: 20px; }
        .title { color: var(--accent); font-size: 12px; font-weight: 800; text-transform: uppercase; margin-bottom: 15px; display: block; letter-spacing: 1px; }
        
        .input-box { width: 100%; padding: 14px; background: #09090b; border: 1px solid var(--border); color: white; border-radius: 10px; margin-bottom: 12px; font-size: 14px; }
        .input-box:focus { border-color: var(--accent); }

        /* KONSOL SÄ°STEMÄ° */
        .console-container { 
            display: flex; flex-direction: column; background: #000; border: 1px solid var(--border); 
            border-radius: 14px; overflow: hidden; height: 50vh !important;
        }
        #log-output { 
            flex: 1; overflow-y: auto; padding: 12px; font-size: 12px; 
            line-height: 1.6; color: #d4d4d8; font-family: 'Consolas', monospace;
            background: #050505;
        }
        .log-line { border-bottom: 1px solid #111; padding: 4px 0; display: block; word-break: break-all; }
        .log-line.system { color: var(--accent); font-style: italic; }

        .chat-area { display: flex; background: #0f0f12; padding: 10px; gap: 8px; border-top: 1px solid var(--border); }
        .chat-area input { flex: 1; background: #18181b; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 8px; }
        .chat-area button { background: var(--accent); border: none; padding: 0 20px; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; }

        /* ENVANTER VE DURUM */
        .progress { height: 10px; background: #27272a; border-radius: 5px; margin: 8px 0 15px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; transition: 0.5s ease-out; }

        .inv-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 5px; }
        .slot { aspect-ratio: 1; background: #09090b; border: 1px solid var(--border); border-radius: 6px; display: flex; align-items: center; justify-content: center; position: relative; }
        .slot img { width: 70%; image-rendering: pixelated; }
        .slot:hover { border-color: var(--accent); }

        /* AYARLAR - GELÄ°ÅMÄ°Å */
        .setting-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #27272a; }
        .setting-info { display: flex; flex-direction: column; }
        .setting-info span { font-size: 14px; font-weight: 600; }
        .setting-info small { color: #71717a; font-size: 11px; }

        .toggle-btn { 
            padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border); 
            background: #18181b; color: #71717a; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .toggle-btn.on { background: var(--green); color: white; border-color: var(--green); }
        .num-input { width: 60px; padding: 8px; background: #09090b; border: 1px solid var(--border); color: white; border-radius: 6px; text-align: center; }

        #ctx { display: none; position: fixed; background: #1c1c1f; border: 1px solid var(--border); border-radius: 10px; z-index: 999; width: 130px; }
        #ctx button { display: block; width: 100%; padding: 12px; background: none; border: none; color: white; text-align: left; border-bottom: 1px solid #27272a; cursor: pointer; }
    </style>
</head>
<body onclick="closeCtx()">

    <nav>
        <button onclick="changeTab('bots', this)" class="active">BAÄLANTI</button>
        <button onclick="changeTab('console', this)">KONSOL</button>
        <button onclick="changeTab('status', this)">DURUM</button>
        <button onclick="changeTab('settings', this)">AYARLAR</button>
    </nav>

    <div id="ctx"><button onclick="invAct('drop')">ğŸ—‘ï¸ At</button><button onclick="invAct('equip')">âš”ï¸ Elinde Tut</button></div>

    <div id="p-bots" class="tab show">
        <div class="card">
            <span class="title">Sisteme GiriÅŸ</span>
            <input id="in-ip" class="input-box" placeholder="Sunucu IP:Port">
            <input id="in-user" class="input-box" placeholder="Bot KullanÄ±cÄ± AdÄ±">
            <button onclick="startBot()" style="width: 100%; padding: 15px; border-radius: 12px; background: var(--green); color: white; border: none; font-weight: 800; cursor: pointer;">BOTU BAÅLAT</button>
        </div>
        <div id="bot-list"></div>
    </div>

    <div id="p-console" class="tab">
        <span class="title" id="console-label">Bot SeÃ§ilmedi</span>
        <div class="console-container">
            <div id="log-output"></div>
            <div class="chat-area">
                <input id="chat-msg" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." onkeydown="if(event.key==='Enter') sendChat()">
                <button onclick="sendChat()">GÃ–NDER</button>
            </div>
        </div>
    </div>

    <div id="p-status" class="tab">
        <div class="card">
            <span class="title">Karakter Durumu</span>
            <div style="display:flex; justify-content:space-between; font-size:12px"><span>SaÄŸlÄ±k</span><span id="hp-txt">0/20</span></div>
            <div class="progress"><div id="hp-bar" class="progress-fill" style="background:var(--red)"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:12px"><span>AÃ§lÄ±k</span><span id="fd-txt">0/20</span></div>
            <div class="progress"><div id="fd-bar" class="progress-fill" style="background:var(--green)"></div></div>
        </div>
        <div class="card">
            <span class="title">Envanter</span>
            <div id="inv-render" class="inv-grid"></div>
        </div>
    </div>

    <div id="p-settings" class="tab">
        <div class="card">
            <span class="title">Otomatik Mesaj (Spammer)</span>
            <input id="auto-msg-text" class="input-box" placeholder="GÃ¶nderilecek mesaj...">
            <div class="setting-row">
                <div class="setting-info"><span>Gecikme (Saniye)</span><small>Mesaj aralÄ±ÄŸÄ±nÄ± belirleyin</small></div>
                <input type="number" id="auto-msg-sec" class="num-input" value="30">
            </div>
            <button id="sw-msg" class="toggle-btn" style="width:100%; margin-top:10px" onclick="toggleSetting('auto_msg', this, ['auto-msg-text', 'auto-msg-sec'])">OTOMATÄ°K MESAJI AÃ‡</button>
        </div>

        <div class="card">
            <span class="title">Hareket KontrolÃ¼</span>
            <div class="setting-row">
                <div class="setting-info"><span>SÃ¼rekli Ä°lerle</span><small>Bot durmadan ileri yÃ¼rÃ¼r</small></div>
                <button id="sw-move" class="toggle-btn" onclick="toggleSetting('move', this)">KAPALI</button>
            </div>
            <div class="setting-row">
                <div class="setting-info"><span>ZÄ±playarak Git</span><small>Hareket halindeyken zÄ±plar</small></div>
                <button id="sw-jump" class="toggle-btn" onclick="toggleSetting('jump', this)">KAPALI</button>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px">
                <button class="toggle-btn" onclick="directAction('look', 'left')">â¬…ï¸ SOLA DÃ–N</button>
                <button class="toggle-btn" onclick="directAction('look', 'right')">â¡ï¸ SAÄA DÃ–N</button>
                <button class="toggle-btn" onclick="directAction('look', 'back')">ğŸ”„ GERÄ°YE DÃ–N</button>
                <button class="toggle-btn" onclick="directAction('action', 'swing')">ğŸ‘Š EL SALLA</button>
            </div>
        </div>
    </div>

    <script>
        const SESSION_ID = 'S_' + Math.random().toString(36).substr(2, 6);
        let currentBot = null;
        let botLogs = {}; // Hesap bazlÄ± loglar burada tutulur
        let slotIndex = 0;

        function changeTab(id, btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('show'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById('p-' + id).classList.add('show');
            btn.classList.add('active');
            if(id === 'console' && currentBot) renderLogs();
        }

        function renderLogs() {
            const out = document.getElementById('log-output');
            out.innerHTML = (botLogs[currentBot] || []).map(l => `<span class="log-line">${l}</span>`).join('');
            // Otomatik aÅŸaÄŸÄ± kaydÄ±rma kapalÄ±. KullanÄ±cÄ± kendisi kaydÄ±rÄ±r.
        }

        async function startBot() {
            const ip = document.getElementById('in-ip').value;
            const user = document.getElementById('in-user').value;
            if(!ip || !user) return;
            
            await fetch(`/start?sid=${SESSION_ID}&host=${ip}&user=${user}`);
            currentBot = user;
            if(!botLogs[user]) botLogs[user] = ["<span class='system'>Sistem: BaÄŸlantÄ± baÅŸlatÄ±ldÄ±...</span>"];
            
            document.getElementById('console-label').innerText = "Aktif: " + user;
            changeTab('console', document.querySelectorAll('nav button')[1]);
        }

        async function sendChat() {
            const inp = document.getElementById('chat-msg');
            if(!currentBot || !inp.value) return;
            await fetch(`/send?sid=${SESSION_ID}&user=${currentBot}&msg=${encodeURIComponent(inp.value)}`);
            inp.value = '';
        }

        async function toggleSetting(type, btn, inputIds = []) {
            if(!currentBot) return;
            const isOff = !btn.classList.contains('on');
            let vals = inputIds.map(id => document.getElementById(id).value);
            
            await fetch(`/update?sid=${SESSION_ID}&user=${currentBot}&type=${type}&status=${isOff?'on':'off'}&val=${vals.join('|')}`);
            
            btn.classList.toggle('on');
            btn.innerText = btn.classList.contains('on') ? "Ã–ZELLÄ°K AKTÄ°F" : "Ã–ZELLÄ°K KAPALI";
        }

        async function directAction(type, val) {
            if(!currentBot) return;
            await fetch(`/update?sid=${SESSION_ID}&user=${currentBot}&type=${type}&val=${val}`);
        }

        function openCtx(e, s) { e.stopPropagation(); slotIndex=s; const m=document.getElementById('ctx'); m.style.display='block'; m.style.left=e.pageX+'px'; m.style.top=e.pageY+'px'; }
        function closeCtx() { document.getElementById('ctx').style.display='none'; }
        async function invAct(act) { await fetch(`/update?sid=${SESSION_ID}&user=${currentBot}&type=inv_action&slot=${slotIndex}&act=${act}`); }

        // ANA DÃ–NGÃœ
        setInterval(async () => {
            try {
                const res = await fetch(`/data?sid=${SESSION_ID}&user=${currentBot || ''}`);
                const data = await res.json();

                // Aktif Bot Listesi
                const bl = document.getElementById('bot-list');
                bl.innerHTML = data.active.map(b => `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center; border-color:${currentBot==b?'var(--accent)':'var(--border)'}" onclick="currentBot='${b}'; document.getElementById('console-label').innerText='Aktif: ${b}'; renderLogs();">
                        <strong>${b}</strong>
                        <button onclick="fetch('/stop?sid=${SESSION_ID}&user=${b}')" style="background:var(--red); color:white; border:none; padding:6px 12px; border-radius:8px; font-size:10px; cursor:pointer">Ã‡IKIÅ YAP</button>
                    </div>
                `).join('');

                if(currentBot && data.botData[currentBot]) {
                    const b = data.botData[currentBot];
                    
                    // Hesap BazlÄ± Log BirleÅŸtirme
                    if(b.logs && b.logs.length > 0) {
                        if(!botLogs[currentBot]) botLogs[currentBot] = [];
                        // Sadece yeni loglarÄ± ekle
                        const newLogs = b.logs.filter(l => !botLogs[currentBot].includes(l));
                        if(newLogs.length > 0) {
                            botLogs[currentBot].push(...newLogs);
                            renderLogs();
                        }
                    }

                    // Durum BarlarÄ±
                    document.getElementById('hp-txt').innerText = `${Math.round(b.health)}/20`;
                    document.getElementById('hp-bar').style.width = (b.health / 20 * 100) + '%';
                    document.getElementById('fd-txt').innerText = `${Math.round(b.food)}/20`;
                    document.getElementById('fd-bar').style.width = (b.food / 20 * 100) + '%';

                    // Envanter Render
                    const ir = document.getElementById('inv-render');
                    ir.innerHTML = '';
                    for(let i=9; i<45; i++) {
                        const it = b.inventory.find(x => x && x.slot === i);
                        ir.innerHTML += `<div class="slot" oncontextmenu="openCtx(event, ${i})">${it?`<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png">`:''}</div>`;
                    }
                }
            } catch(e) {}
        }, 1200);
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>Minecraft Ultimate Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { background: #080808; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 320px; background: #121212; border-right: 1px solid #333; padding: 20px; display: flex; flex-direction: column; box-sizing: border-box; }
        #main { flex: 1; display: flex; flex-direction: column; background: #000; }
        .bot-card { background: #1e1e1e; padding: 12px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; border: 2px solid transparent; transition: 0.2s; }
        .bot-card.selected { border-color: #00ff88; background: #252525; box-shadow: 0 0 10px rgba(0,255,136,0.2); }
        .bot-card img { width: 40px; height: 40px; border-radius: 6px; pointer-events: none; }
        #console { flex: 1; padding: 20px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 13px; color: #00ff88; line-height: 1.5; }
        .bottom-bar { background: #121212; padding: 15px; border-top: 1px solid #222; }
        .move-btn { background: #333; color: #fff; width: 45px; height: 45px; border-radius: 6px; cursor: pointer; border: none; font-weight: bold; }
        .move-btn.active { background: #ff4757; box-shadow: 0 0 8px #ff4757; }
        input, select, button { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; margin: 4px 0; width: 100%; box-sizing: border-box; outline: none; }
        button { background: #00ff88; color: #000; font-weight: bold; border: none; cursor: pointer; }
        .stop-btn { width: auto; padding: 4px 8px; background: #ff4757; color: white; font-size: 10px; border-radius: 4px; }
        .tab-hint { font-size: 11px; color: #555; margin-top: 5px; }
    </style>
</head>
<body>

<div id="sidebar">
    <h3 style="color:#00ff88; margin:0 0 15px 0;">AKTİF BOTLARIN</h3>
    <div id="botList"></div>
    <div style="margin-top:auto;">
        <input type="text" id="host" placeholder="Sunucu IP">
        <input type="text" id="user" placeholder="Bot İsmi">
        <select id="ver">
            <option value="auto">Otomatik Algıla</option>
            <option value="1.21.8">1.21.8</option>
            <option value="1.21.6">1.21.6</option>
            <option value="1.21.4">1.21.4</option>
            <option value="1.21">1.21</option>
            <option value="1.20.4">1.20.4</option>
            <option value="1.20.1">1.20.1</option>
            <option value="1.19.4">1.19.4</option>
            <option value="1.16.5">1.16.5</option>
            <option value="1.12.2">1.12.2</option>
            <option value="1.8.9">1.8.9</option>
        </select>
        <button onclick="login()">SUNUCUYA SOK</button>
    </div>
</div>

<div id="main">
    <div id="console">Oturum açıldı. Bot başlatmanız bekleniyor...</div>
    <div class="bottom-bar">
        <div style="display:flex; gap:15px; align-items:center;">
            <div style="display:grid; grid-template-columns: repeat(3, 45px); gap:5px;">
                <div></div><button class="move-btn" id="forward" onclick="m('forward')">W</button><div></div>
                <button class="move-btn" id="left" onclick="m('left')">A</button><button class="move-btn" id="back" onclick="m('back')">S</button><button class="move-btn" id="right" onclick="m('right')">D</button>
            </div>
            <div style="flex:1;">
                <input type="text" id="chat" placeholder="Mesaj (Tab ile oyuncu tamamla)..." autocomplete="off">
                <div class="tab-hint">Seçili botun oyuncu listesi için <b>TAB</b>'a bas.</div>
            </div>
            <button onclick="send()" style="width:100px;">GÖNDER</button>
        </div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let selectedBot = null;
    let serverPlayers = [];
    let tabResults = [];
    let tabIndex = 0;
    let lastSearch = "";

    function login() {
        socket.emit('login', { host: document.getElementById('host').value, user: document.getElementById('user').value, version: document.getElementById('ver').value });
    }

    const chatInput = document.getElementById('chat');
    chatInput.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
            e.preventDefault();
            const words = this.value.split(" ");
            const lastWord = words[words.length - 1];
            if (lastWord.length > 0) {
                if (lastWord !== lastSearch && !tabResults.includes(lastWord)) {
                    lastSearch = lastWord;
                    tabResults = serverPlayers.filter(p => p.toLowerCase().startsWith(lastSearch.toLowerCase()));
                    tabIndex = 0;
                }
                if (tabResults.length > 0) {
                    words[words.length - 1] = tabResults[tabIndex];
                    this.value = words.join(" ");
                    tabIndex = (tabIndex + 1) % tabResults.length;
                }
            }
        } else if (e.key !== 'Shift') { lastSearch = ""; tabResults = []; }
        if (e.key === 'Enter') send();
    });

    socket.on('playerList', (data) => { if (data.id === selectedBot) serverPlayers = data.players; });

    socket.on('botUpdate', (ids) => {
        const list = document.getElementById('botList');
        list.innerHTML = '';
        ids.forEach(id => {
            const card = document.createElement('div');
            card.className = `bot-card ${selectedBot === id ? 'selected' : ''}`;
            card.onclick = () => { selectedBot = id; socket.emit('botUpdate', ids); };
            card.innerHTML = `
                <img src="https://mc-heads.net/avatar/${id}">
                <div style="flex:1;font-weight:bold;font-size:13px;">${id}</div>
                <button class="stop-btn" onclick="socket.emit('stopBot','${id}')">KAPAT</button>
            `;
            list.appendChild(card);
        });
    });

    function send() {
        if(!selectedBot) return;
        socket.emit('sendMessage', { id: selectedBot, msg: chatInput.value });
        chatInput.value = '';
    }

    function m(dir) {
        if(!selectedBot) return;
        document.getElementById(dir).classList.toggle('active');
        socket.emit('move', { id: selectedBot, dir: dir });
    }

    socket.on('botLog', (d) => {
        const c = document.getElementById('console');
        const line = document.createElement('div');
        line.innerHTML = `<span style="color:#555;">[${d.id}]</span> ${ansiToHtml(d.msg)}`;
        c.appendChild(line);
        c.scrollTop = c.scrollHeight;
    });

    socket.on('log', (m) => {
        const c = document.getElementById('console');
        c.innerHTML += `<div style="color:#aaa; font-style:italic;">> ${m}</div>`;
        c.scrollTop = c.scrollHeight;
    });

    function ansiToHtml(ansi) {
        const colors = {'0':'#000','1':'#0000aa','2':'#00aa00','3':'#00aaaa','4':'#aa0000','5':'#aa00aa','6':'#ffaa00','7':'#aaaaaa','8':'#555555','9':'#5555ff','a':'#55ff55','b':'#55ffff','c':'#ff5555','d':'#ff55ff','e':'#ffff55','f':'#ffffff'};
        return ansi.replace(/§([0-9a-f])/g, (m, c) => `</span><span style="color:${colors[c]}">`) + '</span>';
    }
</script>
</body>
</html>

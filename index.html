<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BotMaster v16 Balanced</title>
    <style>
        :root { --bg: #09090b; --panel: #18181b; --border: #27272a; --accent: #8b5cf6; --text: #e4e4e7; --green: #22c55e; --red: #ef4444; }
        * { box-sizing: border-box; outline: none; user-select: none; }
        body { background: var(--bg); color: var(--text); margin: 0; font-family: 'Inter', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        nav { display: flex; background: var(--panel); height: 55px; border-bottom: 1px solid var(--border); padding: 0 10px; align-items: center; gap: 5px; flex-shrink: 0; }
        nav button { flex: 1; background: transparent; border: 1px solid transparent; color: #71717a; font-weight: 600; font-size: 13px; cursor: pointer; padding: 8px; border-radius: 6px; }
        nav button.active { background: #27272a; color: white; border-color: #3f3f46; }
        
        .tab { display: none; height: calc(100vh - 55px); padding: 15px; flex-direction: column; max-width: 800px; margin: 0 auto; width: 100%; }
        .tab.show { display: flex; }

        /* [KONSOL - ORTA BOY %50 AYARI] */
        #p-console { overflow: hidden; justify-content: flex-start; }
        .console-box { 
            display: flex; flex-direction: column; background: #000; border: 2px solid var(--border); border-radius: 12px; overflow: hidden;
            height: 50vh !important; /* EKRANIN TAM YARISI */
            min-height: 300px; /* ÇOK KÜÇÜK EKRANLARDA EZİLMEMESİ İÇİN */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #log-output { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; line-height: 1.5; color: #d4d4d8; font-family: 'Consolas', monospace; background: linear-gradient(to bottom, #000, #050505); }
        #log-output div { border-bottom: 1px solid #111; padding: 4px 0; word-break: break-word; white-space: pre-wrap; }

        .chat-input-area { display: flex; border-top: 1px solid var(--border); background: #111; padding: 10px; gap: 8px; }
        .chat-input-area input { flex: 1; background: #1d1d20; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 8px; font-size: 14px; }
        .chat-input-area button { background: var(--accent); color: white; border: none; padding: 0 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .title { color: var(--accent); font-size: 11px; font-weight: 800; text-transform: uppercase; margin-bottom: 15px; display: block; opacity: 0.8; }
        input.main-input { width: 100%; padding: 12px; background: #27272a; border: 1px solid var(--border); color: white; border-radius: 8px; margin-bottom: 10px; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        .btn-green { background: var(--green); }
        
        .stat-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-size: 12px; font-weight: bold; }
        .progress-bg { height: 12px; background: #27272a; border-radius: 6px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.3s ease; }
        .hp { background: #ef4444; } .fd { background: #f59e0b; }

        .inv-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 4px; }
        .slot { aspect-ratio: 1; background: #27272a; border-radius: 4px; position: relative; display: flex; align-items: center; justify-content: center; border: 1px solid transparent; }
        .slot img { width: 70%; image-rendering: pixelated; }
        .count { position: absolute; bottom: 2px; right: 2px; font-size: 10px; font-weight: bold; }

        .setting-item { display: flex; justify-content: space-between; align-items: center; background: #27272a; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .toggle { padding: 6px 12px; border-radius: 4px; font-size: 11px; font-weight: bold; cursor: pointer; border: 1px solid var(--border); background: #18181b; color: #71717a; }
        .toggle.on { background: var(--green); color: white; }
        #ctx { display: none; position: absolute; background: #18181b; border: 1px solid var(--border); border-radius: 6px; z-index: 1000; width: 140px; }
        #ctx button { display: block; width: 100%; padding: 12px; background: none; border: none; color: white; text-align: left; cursor: pointer; border-bottom: 1px solid var(--border); }
    </style>
</head>
<body onclick="closeCtx()">
    <nav>
        <button onclick="tab('bots')" id="t-bots" class="active">BAĞLANTI</button>
        <button onclick="tab('console')" id="t-console">KONSOL</button>
        <button onclick="tab('inv')" id="t-inv">ENVANTER</button>
        <button onclick="tab('settings')" id="t-settings">AYARLAR</button>
    </nav>

    <div id="ctx"><button onclick="act('drop')">At</button><button onclick="act('equip')">Ele Al</button><button onclick="act('use')">Ye</button></div>

    <div id="p-bots" class="tab show">
        <div class="card">
            <span class="title">Bot Girişi</span>
            <input id="host" class="main-input" placeholder="IP:Port">
            <input id="user" class="main-input" placeholder="Kullanıcı Adı">
            <button class="btn btn-green" onclick="startBot()">BAĞLAN</button>
        </div>
        <div id="bot-list"></div>
    </div>

    <div id="p-console" class="tab">
        <span class="title">Sunucu Günlüğü</span>
        <div class="console-box">
            <div id="log-output"></div>
            <div class="chat-input-area">
                <input id="chat-in" placeholder="Mesaj yaz veya komut gönder..." onkeydown="if(event.key==='Enter') sendChat()">
                <button onclick="sendChat()">GÖNDER</button>
            </div>
        </div>
    </div>

    <div id="p-inv" class="tab">
        <div class="card">
            <span class="title">Durum</span>
            <div class="stat-row"><span>Can</span><span id="txt-hp">20</span></div>
            <div class="progress-bg"><div id="bar-hp" class="progress-fill hp"></div></div>
            <div class="stat-row" style="margin-top:10px;"><span>Açlık</span><span id="txt-fd">20</span></div>
            <div class="progress-bg"><div id="bar-fd" class="progress-fill fd"></div></div>
        </div>
        <div class="card"><div id="inv-grid" class="inv-grid"></div></div>
    </div>

    <div id="p-settings" class="tab">
        <div class="card">
            <span class="title">Otomasyon</span>
            <div class="setting-item"><h4>Oto-Kazma</h4><button class="toggle" onclick="toggle('mining', 'val-mine', this)">KAPALI</button></div>
            <div class="setting-item"><h4>Anti-AFK</h4><button class="toggle" onclick="toggle('afk', null, this)">KAPALI</button></div>
        </div>
    </div>

    <script>
        const sid = localStorage.getItem('sid') || 's_'+Math.random().toString(36).substr(2);
        localStorage.setItem('sid', sid);
        let sel = null; let autoScroll = true;

        function tab(id) {
            document.querySelectorAll('.tab').forEach(e => e.classList.remove('show'));
            document.querySelectorAll('nav button').forEach(e => e.classList.remove('active'));
            document.getElementById('p-'+id).classList.add('show');
            document.getElementById('t-'+id).classList.add('active');
        }

        function openCtx(e, s) { e.stopPropagation(); const m=document.getElementById('ctx'); m.style.display='block'; m.style.left=e.pageX+'px'; m.style.top=e.pageY+'px'; }
        function closeCtx() { document.getElementById('ctx').style.display='none'; }
        document.getElementById('log-output').addEventListener('scroll', function() { autoScroll = (this.scrollTop + this.clientHeight >= this.scrollHeight - 20); });

        async function startBot() {
            const h = document.getElementById('host').value, u = document.getElementById('user').value;
            if(!h || !u) return;
            await fetch(`/start?sid=${sid}&host=${h}&user=${u}`);
            sel = u; tab('console');
        }

        async function sendChat() {
            const i = document.getElementById('chat-in');
            if(!sel || !i.value) return;
            await fetch(`/send?sid=${sid}&user=${sel}&msg=${encodeURIComponent(i.value)}`);
            i.value = '';
        }

        async function toggle(t, v, b) {
            if(!sel) return;
            const s = b.classList.contains('on') ? 'off' : 'on';
            await fetch(`/update?sid=${sid}&user=${sel}&type=${t}&status=${s}&val=0`);
            b.classList.toggle('on'); b.innerText = b.classList.contains('on') ? "AÇIK" : "KAPALI";
        }

        setInterval(async () => {
            try {
                const res = await fetch(`/data?sid=${sid}&user=${sel || ''}`);
                const data = await res.json();
                document.getElementById('bot-list').innerHTML = data.active.map(b => `<div class="card" onclick="sel='${b}'" style="border-color:${sel==b?'var(--accent)':'var(--border)'}">${b}</div>`).join('');

                if(sel && data.botData[sel]) {
                    const b = data.botData[sel];
                    const lo = document.getElementById('log-output');
                    // Mesajları temizle ve her veriyi (string, object vb) okunabilir yap
                    lo.innerHTML = b.logs.map(l => `<div>${typeof l === 'object' ? JSON.stringify(l) : l}</div>`).join('');
                    if(autoScroll) lo.scrollTop = lo.scrollHeight;

                    document.getElementById('bar-hp').style.width = (b.health / 20 * 100) + '%';
                    document.getElementById('bar-fd').style.width = (b.food / 20 * 100) + '%';
                    const ig = document.getElementById('inv-grid'); ig.innerHTML = '';
                    for(let i=9; i<45; i++) {
                        const it = b.inventory.find(x => x && x.slot === i);
                        ig.innerHTML += `<div class="slot" onclick="${it?'openCtx(event)':''}">${it?`<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png"><span class="count">${it.count}</span>`:''}</div>`;
                    }
                }
            } catch(e) {}
        }, 1000);
    </script>
</body>
</html>

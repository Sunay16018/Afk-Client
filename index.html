<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Master v13</title>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; font-size: 13px; }
        body { background: #0d1117; color: #c9d1d9; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        nav { display: flex; background: #161b22; height: 45px; border-bottom: 1px solid #30363d; flex-shrink: 0; }
        nav button { flex: 1; border: none; background: none; color: #8b949e; cursor: pointer; font-weight: bold; }
        nav button.active { color: #58a6ff; border-bottom: 2px solid #58a6ff; }
        .tab { display: none; flex: 1; flex-direction: column; padding: 10px; overflow-y: auto; }
        .active-tab { display: flex; }
        .card { background: #161b22; padding: 12px; border-radius: 8px; border: 1px solid #30363d; margin-bottom: 10px; position: relative; }
        
        .bar-container { display: flex; gap: 2px; margin: 5px 0; height: 20px; }
        .icon { width: 18px; height: 18px; background-size: cover; image-rendering: pixelated; }
        .heart-full { background-image: url('https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/gui/heart/full.png'); }
        .heart-empty { background-image: url('https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/gui/heart/container.png'); }
        .food-full { background-image: url('https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/gui/food/full.png'); }
        .food-empty { background-image: url('https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/gui/food/container.png'); }

        .inventory-grid { display: grid; grid-template-columns: repeat(9, 34px); gap: 2px; background: #8b8b8b; padding: 4px; border: 2px solid #373737; width: fit-content; margin: 0 auto; }
        .inv-slot { width: 34px; height: 34px; background: #8b8b8b; border: 2px solid #373737; position: relative; display: flex; align-items: center; justify-content: center; }
        .item-img { width: 24px; height: 24px; image-rendering: pixelated; cursor: pointer; }
        .item-count { position: absolute; bottom: 1px; right: 1px; font-size: 10px; color: white; text-shadow: 1px 1px black; pointer-events: none; }

        #logbox { height: 300px; background: #000; padding: 10px; overflow-y: auto; color: #3fb950; font-family: monospace; border: 1px solid #30363d; border-radius: 6px; }
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; background: #21262d; border: 1px solid #30363d; }
        .btn-green { background: #238636; } .btn-red { background: #da3633; }
        
        #item-opt { display: none; position: absolute; background: #1c2128; border: 1px solid #58a6ff; border-radius: 4px; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.8); }
        #item-opt button { display: block; width: 100%; padding: 8px 12px; background: none; border: none; color: white; text-align: left; cursor: pointer; border-bottom: 1px solid #30363d; }
    </style>
</head>
<body onclick="hideOpt()">
    <nav>
        <button onclick="tab('bots')" id="btn-bots" class="active">BOTLAR</button>
        <button onclick="tab('settings')" id="btn-settings">AYARLAR</button>
        <button onclick="tab('stats')" id="id-stats">İSTATİSTİK</button>
        <button onclick="tab('term')" id="btn-term">KONSOL</button>
    </nav>

    <div id="item-opt">
        <button onclick="invOp('drop')">Eşyayı At</button>
        <button onclick="invOp('use')">Kullan/Sağ Tık</button>
    </div>

    <div id="tab-bots" class="tab active-tab">
        <div class="card">
            <input id="h" placeholder="IP:Port" style="width:100%; padding:8px; margin-bottom:5px; background:#010409; color:white; border:1px solid #30363d; border-radius:6px;">
            <input id="u" placeholder="Nick" style="width:100%; padding:8px; margin-bottom:5px; background:#010409; color:white; border:1px solid #30363d; border-radius:6px;">
            <button class="btn btn-green" style="width:100%" onclick="add()">BAĞLAT</button>
        </div>
        <div id="list"></div>
    </div>

    <div id="tab-stats" class="tab">
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <label>SAĞLIK</label><div id="hp-bar" class="bar-container"></div>
                <label>AÇLIK</label><div id="fd-bar" class="bar-container"></div>
            </div>
            <button class="btn btn-red" onclick="quitBot(sel)">BAĞLANTIYI KES</button>
        </div>
        <div class="card" style="overflow-x:auto;">
            <div id="inv-main" class="inventory-grid" style="margin-bottom:8px;"></div>
            <div id="inv-hot" class="inventory-grid"></div>
        </div>
    </div>

    <div id="tab-term" class="tab">
        <div id="logbox"></div>
        <div style="display:flex; margin-top:5px; gap:5px;">
            <input id="m" placeholder="Sohbete yaz..." onkeydown="if(event.key==='Enter') doSend()" style="flex:1; background:#010409; color:white; border:1px solid #30363d; padding:8px; border-radius:6px;">
            <button class="btn" onclick="doSend()">GÖNDER</button>
        </div>
    </div>

    <script>
        const mySID = localStorage.getItem('sid') || 'sid_'+Math.random().toString(36).substr(2,9);
        localStorage.setItem('sid', mySID);
        let sel = ""; let curSlot = null;

        function tab(t) {
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active-tab'));
            document.querySelectorAll('nav button').forEach(x => x.classList.remove('active'));
            document.getElementById('tab-'+t == 'tab-stats' ? 'id-stats' : 'tab-'+t).classList.add('active-tab');
            document.querySelector(`[onclick="tab('${t}')"]`).classList.add('active');
        }

        function initUI() {
            document.getElementById('hp-bar').innerHTML = '<div class="icon heart-empty"></div>'.repeat(10);
            document.getElementById('fd-bar').innerHTML = '<div class="icon food-empty"></div>'.repeat(10);
            let mH = '', hH = '';
            for(let i=9; i<36; i++) mH += `<div class="inv-slot" id="s-${i}"></div>`;
            for(let i=36; i<45; i++) hH += `<div class="inv-slot" id="s-${i}"></div>`;
            document.getElementById('inv-main').innerHTML = mH;
            document.getElementById('inv-hot').innerHTML = hH;
        }
        initUI();

        async function add() {
            await fetch(`/start?sid=${mySID}&host=${document.getElementById('h').value}&user=${document.getElementById('u').value}`);
            sel = document.getElementById('u').value; tab('term');
        }

        async function quitBot(n) { await fetch(`/stop?sid=${mySID}&user=${n}`); if(sel==n) sel=""; }

        function showOpt(e, slot) {
            e.stopPropagation(); curSlot = slot;
            const m = document.getElementById('item-opt');
            m.style.display = 'block'; m.style.left = e.pageX + 'px'; m.style.top = e.pageY + 'px';
        }
        function hideOpt() { document.getElementById('item-opt').style.display = 'none'; }
        async function invOp(act) { await fetch(`/update?sid=${mySID}&user=${sel}&type=inv_action&slot=${curSlot}&act=${act}`); hideOpt(); }

        async function doSend() {
            const i = document.getElementById('m');
            await fetch(`/send?sid=${mySID}&user=${sel}&msg=${encodeURIComponent(i.value)}`);
            i.value = "";
        }

        setInterval(async () => {
            try {
                const r = await fetch(`/data?sid=${mySID}&user=${sel}`);
                const d = await r.json();
                
                document.getElementById('list').innerHTML = d.active.map(n => `
                    <div class="bot-item" style="border-color:${sel==n?'#58a6ff':'#30363d'}" onclick="sel='${n}'">
                        <span>${n}</span> <button class="btn btn-red" style="font-size:10px; padding:3px 7px;" onclick="event.stopPropagation(); quitBot('${n}')">KES</button>
                    </div>
                `).join('');

                if(sel && d.botData[sel]) {
                    const b = d.botData[sel];
                    let h = Math.ceil(b.health/2), f = Math.ceil(b.food/2);
                    document.getElementById('hp-bar').innerHTML = '<div class="icon heart-full"></div>'.repeat(h) + '<div class="icon heart-empty"></div>'.repeat(10-h);
                    document.getElementById('fd-bar').innerHTML = '<div class="icon food-full"></div>'.repeat(f) + '<div class="icon food-empty"></div>'.repeat(10-f);

                    document.querySelectorAll('.inv-slot').forEach(s => s.innerHTML = '');
                    b.inventory.forEach(item => {
                        if(item) {
                            const div = document.getElementById(`s-${item.slot}`);
                            if(div) {
                                div.innerHTML = `<img class="item-img" src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${item.name}.png" onclick="showOpt(event, ${item.slot})"><span class="item-count">${item.count > 1 ? item.count : ''}</span>`;
                            }
                        }
                    });
                    document.getElementById('logbox').innerHTML = b.logs.join('<br>');
                }
            } catch(e) {}
        }, 1500);
    </script>
</body>
</html>

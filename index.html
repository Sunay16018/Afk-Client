<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bot Master v4</title>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; font-size: 13px; }
        body { background: #0b0e14; color: #adbac7; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        nav { display: flex; background: #1c2128; border-bottom: 1px solid #444c56; height: 50px; }
        nav button { flex: 1; border: none; background: none; color: #768390; cursor: pointer; font-weight: bold; }
        nav button.active { color: #538bff; border-bottom: 3px solid #538bff; }
        .tab { display: none; flex: 1; flex-direction: column; padding: 15px; overflow-y: auto; }
        .active-tab { display: flex; }
        .card { background: #22272e; padding: 15px; border-radius: 10px; border: 1px solid #444c56; margin-bottom: 15px; }
        .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; background: #316dca; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-green { background: #347d39; } .btn-red { background: #ae2e24; } .btn-gray { background: #444c56; }
        input { background: #1c2128; border: 1px solid #444c56; color: #adbac7; padding: 10px; width: 100%; border-radius: 6px; margin-bottom: 8px; }
        label { font-size: 11px; color: #768390; display: block; margin-bottom: 4px; text-transform: uppercase; }
        #logbox { height: 180px; background: #000; padding: 10px; overflow-y: auto; color: #adbac7; font-family: monospace; border-radius: 8px; border: 1px solid #444c56; }
    </style>
</head>
<body>
    <nav>
        <button onclick="tab('bots')" id="btn-bots" class="active">BAĞLANTI</button>
        <button onclick="tab('settings')" id="btn-settings">AYARLAR</button>
        <button onclick="tab('term')" id="btn-term">LOGLAR</button>
    </nav>

    <div id="tab-bots" class="tab active-tab">
        <div class="card">
            <input id="h" placeholder="Sunucu IP:Port">
            <input id="u" placeholder="Bot Nick">
            <input id="v" placeholder="Sürüm (örn: 1.16.5)">
            <button class="btn btn-green" style="width:100%" onclick="add()">BOTU BAĞLA</button>
        </div>
        <div id="list"></div>
    </div>

    <div id="tab-settings" class="tab">
        <div class="card" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; text-align: center;">
            <div style="grid-column: 2;"><button class="btn btn-gray" onclick="upd('look','up')">↑</button></div>
            <button class="btn btn-gray" onclick="upd('look','left')">←</button>
            <button class="btn btn-gray" onclick="upd('look','front')">FRONT</button>
            <button class="btn btn-gray" onclick="upd('look','right')">→</button>
            <div style="grid-column: 2;"><button class="btn btn-gray" onclick="upd('look','down')">↓</button></div>
        </div>

        <div class="card">
            <label>Kazma (Sürekli)</label>
            <div style="display: flex; gap: 5px;">
                <button class="btn btn-green" style="flex:1" onclick="upd('mining','on')">AÇ</button>
                <button class="btn btn-red" style="flex:1" onclick="upd('mining','off')">KAPAT</button>
            </div>
            
            <div style="margin-top:15px; border-top: 1px solid #444c56; padding-top:10px;">
                <label>Sağ Tık Hızı (Saniye)</label>
                <input id="s_rclick" type="number" value="0.5" step="0.1">
                <div style="display: flex; gap: 5px;">
                    <button class="btn btn-green" style="flex:1" onclick="upd('rclick','on','s_rclick')">AÇ</button>
                    <button class="btn btn-red" style="flex:1" onclick="upd('rclick','off')">KAPAT</button>
                </div>
            </div>

            <div style="margin-top:15px; border-top: 1px solid #444c56; padding-top:10px;">
                <label>Zıplama Hızı (Saniye)</label>
                <input id="s_jump" type="number" value="1.0" step="0.1">
                <div style="display: flex; gap: 5px;">
                    <button class="btn btn-green" style="flex:1" onclick="upd('jump','on','s_jump')">AÇ</button>
                    <button class="btn btn-red" style="flex:1" onclick="upd('jump','off')">KAPAT</button>
                </div>
            </div>

            <div style="margin-top:15px; border-top: 1px solid #444c56; padding-top:10px;">
                <label>Oto Mesaj (Mesaj | Saniye)</label>
                <input id="s_msg_txt" placeholder="Mesaj...">
                <input id="s_msg_time" type="number" value="10">
                <div style="display: flex; gap: 5px;">
                    <button class="btn btn-green" style="flex:1" onclick="upd_msg('on')">OTO MESAJ AÇ</button>
                    <button class="btn btn-red" style="flex:1" onclick="upd_msg('off')">KAPAT</button>
                </div>
            </div>
        </div>

        <button class="btn btn-red" style="width:100%" onclick="stopBot()">BOTU SİSTEMDEN AT</button>
    </div>

    <div id="tab-term" class="tab">
        <div id="logbox"></div>
        <div style="display:flex; gap:5px; margin-top:10px;">
            <input id="m" placeholder="Sohbet..." style="flex:1; margin:0;">
            <button onclick="doSend()" class="btn">OK</button>
        </div>
    </div>

    <script>
        const mySID = localStorage.getItem('sid') || 'sid_'+Math.random().toString(36).substr(2,9);
        localStorage.setItem('sid', mySID);
        let sel = "";

        function tab(t) {
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active-tab'));
            document.querySelectorAll('nav button').forEach(x => x.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active-tab');
            document.getElementById('btn-'+t).classList.add('active');
        }

        async function add() {
            const h = document.getElementById('h').value, u = document.getElementById('u').value, v = document.getElementById('v').value;
            await fetch(`/start?sid=${mySID}&host=${h}&user=${u}&ver=${v}`);
            sel = u; tab('term');
        }

        async function upd(type, status, inputId) {
            if(!sel) return;
            let sec = inputId ? document.getElementById(inputId).value : 1;
            let url = `/update?sid=${mySID}&user=${sel}&type=${type}&status=${status}&sec=${sec}`;
            if(type === 'look') url += `&dir=${status}`;
            await fetch(url);
        }

        async function upd_msg(status) {
            if(!sel) return;
            const txt = document.getElementById('s_msg_txt').value;
            const sec = document.getElementById('s_msg_time').value;
            await fetch(`/update?sid=${mySID}&user=${sel}&type=automsg&status=${status}&msg=${encodeURIComponent(txt)}&sec=${sec}`);
        }

        async function doSend() {
            const i = document.getElementById('m');
            if(!sel || !i.value) return;
            await fetch(`/send?sid=${mySID}&user=${encodeURIComponent(sel)}&msg=${encodeURIComponent(i.value)}`);
            i.value = "";
        }

        setInterval(async () => {
            try {
                const r = await fetch(`/data?sid=${mySID}`);
                const d = await r.json();
                document.getElementById('list').innerHTML = d.active.map(n => `<div style="padding:12px; background:#1c2128; border:1px solid ${sel==n?'#538bff':'#444c56'}; margin-top:5px; border-radius:8px;" onclick="sel='${n}'">${n}</div>`).join('');
                if(sel && d.logs[sel]) {
                    const lb = document.getElementById('logbox');
                    lb.innerHTML = d.logs[sel].join('<br>');
                    lb.scrollTop = lb.scrollHeight;
                }
            } catch(e) {}
        }, 1000);
    </script>
</body>
</html>

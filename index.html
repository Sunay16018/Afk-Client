<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AFK Client v5 Ultra</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; font-size: 13px; }
        body { background: #0d1117; color: #c9d1d9; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        nav { display: flex; background: #161b22; border-bottom: 1px solid #30363d; height: 50px; }
        nav button { flex: 1; border: none; background: none; color: #8b949e; cursor: pointer; font-weight: bold; }
        nav button.active { color: #2ecc71; border-bottom: 3px solid #2ecc71; }
        .tab { display: none; flex: 1; padding: 15px; overflow-y: auto; flex-direction: column; }
        .active-tab { display: flex; }
        #logbox { height: 350px; background: #000; padding: 10px; overflow-y: auto; font-family: monospace; border-radius: 8px; border: 1px solid #30363d; line-height: 1.6; }
        /* Renklerin korunması için */
        #logbox span { background-color: transparent !important; }
        
        .settings-card { background: #161b22; padding: 15px; border-radius: 8px; border: 1px solid #30363d; margin-bottom: 10px; }
        .status-badge { float: right; font-size: 10px; padding: 2px 6px; border-radius: 4px; }
        .active-bg { background: #238636; color: white; }
        .inactive-bg { background: #da3633; color: white; }
        
        .btn { padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; background: #1f6feb; }
        input { background: #010409; border: 1px solid #30363d; color: #fff; padding: 8px; border-radius: 6px; width: 100%; margin: 5px 0; }
        
        .cmd-row { display: flex; gap: 5px; align-items: center; margin-bottom: 5px; }
        .delay-btn { background: #30363d; color: white; border: 1px solid #444; width: 30px; cursor: pointer; }
    </style>
</head>
<body>
    <nav>
        <button onclick="tab('bots')" id="btn-bots" class="active">BOTLAR</button>
        <button onclick="tab('term')" id="btn-term">KONSOL</button>
        <button onclick="tab('settings')" id="btn-settings">AYARLAR</button>
    </nav>

    <div id="tab-bots" class="tab active-tab">
        <div class="settings-card">
            <input id="h" placeholder="IP:Port">
            <input id="u" placeholder="Kullanıcı Adı">
            <input id="v" placeholder="Sürüm (örn: 1.16.5)">
            <button class="btn" style="width:100%; background:#238636;" onclick="add()">BAĞLAN</button>
        </div>
        <div id="list"></div>
    </div>

    <div id="tab-term" class="tab">
        <div id="logbox"></div>
        <form onsubmit="doSend(event)" style="display:flex; gap:5px;">
            <input id="m" placeholder="Mesaj..." autocomplete="off">
            <button type="submit" class="btn">GÖNDER</button>
        </form>
    </div>

    <div id="tab-settings" class="tab">
        <div class="settings-card">
            <h3>Otomatik Yeniden Bağlanma 
                <span id="st-reconnect" class="status-badge inactive-bg">KAPALI</span>
            </h3>
            <button class="btn" style="width:100%" onclick="toggleReconnect()">AÇ / KAPAT</button>
        </div>

        <div class="settings-card">
            <h3>Bağlantı Sonrası Komutlar</h3>
            <div id="cmd-list"></div>
            <button class="btn" style="width:100%; background:#2ecc71; margin-top:5px;" onclick="addCmdRow()">+ YENİ KOMUT EKLE</button>
            <button class="btn" style="width:100%; background:#1f6feb; margin-top:5px;" onclick="saveCmds()">KOMUTLARI KAYDET</button>
        </div>

        <div class="settings-card">
            <h3>Anti-AFK <span id="st-afk" class="status-badge inactive-bg">KAPALI</span></h3>
            <button class="btn" style="width:100%; background:#8e44ad;" onclick="setSetting('afk')">AÇ / KAPAT</button>
        </div>
    </div>

    <script>
        let mySID = localStorage.getItem('sid') || 'sid_'+Math.random().toString(36).substr(2,9);
        localStorage.setItem('sid', mySID);
        let sel = "";
        let loginCmds = [];

        function tab(t) {
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active-tab'));
            document.querySelectorAll('nav button').forEach(x => x.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active-tab');
            document.getElementById('btn-'+t).classList.add('active');
        }

        async function add() {
            const h = document.getElementById('h').value, u = document.getElementById('u').value, v = document.getElementById('v').value;
            await fetch(`/start?sid=${mySID}&host=${h}&user=${u}&ver=${v}`);
            sel = u; tab('term');
        }

        async function doSend(e) {
            e.preventDefault();
            const i = document.getElementById('m');
            if(!sel || !i.value) return;
            await fetch(`/send?sid=${mySID}&user=${sel}&msg=${encodeURIComponent(i.value)}`);
            i.value = "";
        }

        function addCmdRow(cmd = "", delay = 1) {
            const container = document.getElementById('cmd-list');
            const div = document.createElement('div');
            div.className = 'cmd-row';
            div.innerHTML = `
                <input style="flex:3" value="${cmd}" placeholder="/login sifre">
                <button class="delay-btn" onclick="this.nextElementSibling.innerText = Math.max(1, parseInt(this.nextElementSibling.innerText)-1)">-</button>
                <span style="min-width:20px; text-align:center">${delay}</span>
                <button class="delay-btn" onclick="this.previousElementSibling.innerText = parseInt(this.previousElementSibling.innerText)+1">+</button>
                <button class="btn" style="background:#da3633; padding:5px" onclick="this.parentElement.remove()">X</button>
            `;
            container.appendChild(div);
        }

        async function saveCmds() {
            if(!sel) return;
            const rows = document.querySelectorAll('.cmd-row');
            const cmds = Array.from(rows).map(r => ({
                cmd: r.querySelector('input').value,
                delay: parseInt(r.querySelector('span').innerText)
            }));
            await fetch(`/update?sid=${mySID}&user=${sel}&type=loginCmds&val=${encodeURIComponent(JSON.stringify(cmds))}`);
        }

        async function toggleReconnect() {
            if(!sel) return;
            const badge = document.getElementById('st-reconnect');
            const isOff = badge.innerText === 'KAPALI';
            await fetch(`/update?sid=${mySID}&user=${sel}&type=reconnect&val=${isOff}`);
        }

        async function setSetting(type) {
            if(!sel) return;
            await fetch(`/update?sid=${mySID}&user=${sel}&type=${type}`);
        }

        setInterval(async () => {
            try {
                const r = await fetch(`/data?sid=${mySID}&user=${sel}`);
                const d = await r.json();
                
                document.getElementById('list').innerHTML = d.active.map(n => `
                    <div class="settings-card" style="border-color:${sel==n?'#2ecc71':'#30363d'}" onclick="sel='${n}'">
                        <b>${n}</b> ${sel==n?'(SEÇİLİ)':''}
                        <button class="btn" style="background:#da3633; float:right; padding:5px;" onclick="fetch('/stop?sid=${mySID}&user=${n}')">KAPAT</button>
                    </div>
                `).join('');

                if(sel && d.logs[sel]) {
                    const lb = document.getElementById('logbox');
                    lb.innerHTML = d.logs[sel].join('<br>');
                    lb.scrollTop = lb.scrollHeight;

                    const conf = d.configs[sel];
                    document.getElementById('st-reconnect').innerText = conf.autoReconnect ? "AÇIK" : "KAPALI";
                    document.getElementById('st-reconnect').className = "status-badge " + (conf.autoReconnect ? "active-bg" : "inactive-bg");
                    document.getElementById('st-afk').innerText = conf.afkT ? "AÇIK" : "KAPALI";
                    document.getElementById('st-afk').className = "status-badge " + (conf.afkT ? "active-bg" : "inactive-bg");
                }
            } catch(e) {}
        }, 1000);
    </script>
</body>
</html>

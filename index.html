<!DOCTYPE html>
<html>
<head>
    <title>7/24 Bot Console</title>
    <style>
        body { background: #050505; color: #ccc; font-family: monospace; margin: 0; display: flex; height: 100vh; }
        #sidebar { width: 260px; background: #0f0f0f; border-right: 1px solid #222; padding: 15px; display: flex; flex-direction: column; }
        #main { flex: 1; display: flex; flex-direction: column; }
        .bot-tab { padding: 12px; background: #1a1a1a; margin-bottom: 5px; cursor: pointer; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; border-left: 3px solid transparent; }
        .bot-tab.active { border-left: 3px solid #00ff88; background: #222; color: #fff; }
        .console-box { flex: 1; padding: 15px; overflow-y: auto; display: none; background: #000; color: #00ff88; line-height: 1.4; font-size: 13px; }
        .console-box.active { display: block; }
        .input-area { padding: 15px; background: #0f0f0f; display: flex; gap: 10px; }
        input, select, button { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 8px; border-radius: 4px; outline: none; width: 100%; }
        button { background: #00ff88; color: #000; font-weight: bold; cursor: pointer; border: none; }
        .stop-btn { background: #ff4757; width: auto; font-size: 9px; padding: 2px 5px; }
    </style>
</head>
<body>

<div id="sidebar">
    <h4 style="color:#00ff88; margin:0 0 10px 0;">BOT LİSTESİ</h4>
    <div id="botList"></div>
    <div style="margin-top:auto; border-top:1px solid #222; padding-top:10px;">
        <input id="host" placeholder="Sunucu IP">
        <input id="user" placeholder="Kullanıcı Adı">
        <select id="ver">
            <option value="auto">Otomatik Sürüm</option>
            <option value="1.21.8">1.21.8</option><option value="1.21.4">1.21.4</option>
            <option value="1.20.1">1.20.1</option><option value="1.16.5">1.16.5</option>
            <option value="1.12.2">1.12.2</option><option value="1.8.9">1.8.9</option>
        </select>
        <button onclick="login()">BAĞLAN</button>
    </div>
</div>

<div id="main">
    <div id="consoles"></div>
    <div class="input-area">
        <input id="chat" placeholder="Sohbet mesajı gönder..." onkeydown="if(event.key==='Enter') send()">
        <button onclick="send()" style="width:100px;">GÖNDER</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let selectedBot = null;

    function login() {
        socket.emit('login', { host: document.getElementById('host').value, user: document.getElementById('user').value, version: document.getElementById('ver').value });
    }

    socket.on('botUpdate', ids => {
        const list = document.getElementById('botList');
        list.innerHTML = '';
        ids.forEach(id => {
            if(!document.getElementById(`con_${id}`)) createConsole(id);
            const div = document.createElement('div');
            div.className = `bot-tab ${selectedBot === id ? 'active' : ''}`;
            div.onclick = () => selectBot(id);
            div.innerHTML = `<span>${id}</span><button class="stop-btn" onclick="socket.emit('stopBot','${id}')">X</button>`;
            list.appendChild(div);
        });
        if(ids.length > 0 && !selectedBot) selectBot(ids[0]);
    });

    function createConsole(id) {
        const con = document.createElement('div');
        con.id = `con_${id}`;
        con.className = 'console-box';
        document.getElementById('consoles').appendChild(con);
    }

    function selectBot(id) {
        selectedBot = id;
        document.querySelectorAll('.console-box').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.bot-tab').forEach(t => t.classList.remove('active'));
        if(document.getElementById(`con_${id}`)) document.getElementById(`con_${id}`).classList.add('active');
        socket.emit('botUpdate', Object.keys(sessionBots || {})); // Görsel güncelleme için
    }

    socket.on('botLog', d => {
        const c = document.getElementById(`con_${d.id}`);
        if(c) {
            c.innerHTML += `<div>${ansiToHtml(d.msg)}</div>`;
            c.scrollTop = c.scrollHeight;
        }
    });

    socket.on('log', d => {
        const c = document.getElementById(`con_${d.id}`);
        if(c) c.innerHTML += `<div style="color:#aaa;">${d.msg}</div>`;
    });

    function send() {
        const inp = document.getElementById('chat');
        if(selectedBot && inp.value) {
            socket.emit('chat', { id: selectedBot, msg: inp.value });
            inp.value = '';
        }
    }

    function ansiToHtml(ansi) {
        const colors = {'0':'#000','1':'#00a','2':'#0a0','3':'#0aa','4':'#a00','5':'#a0a','6':'#fa0','7':'#aaa','8':'#555','9':'#55f','a':'#5f5','b':'#5ff','c':'#f55','d':'#f5f','e':'#ff5','f':'#fff'};
        return ansi.replace(/§([0-9a-f])/g, (m, c) => `</span><span style="color:${colors[c]}">`) + '</span>';
    }
</script>
</body>
</html>
